-- Script to generate source files

local yaml = require('yaml')

if #arg < 2 then
	print("usage: lua " .. arg[0] .. " <ifile> <ofile>")
	return
end

local ifile = arg[1]
local ofile = arg[2]

print("reading:", ifile)
print("writing:", ofile)

local f = io.open(ofile, "w+")
if not f then
	print("unable to open file for writing")
	return
end

-- set output file
io.output(f)

-- write warning message
io.write("-- This file was generated by write_models.lua and is not meant to be edited by hand\n")
io.write("-- If you want to define a new model in your own mod, just create a file like this and call the function below\n")

-- load yaml file
local y = yaml.loadpath(ifile)

-- copy the models into lua
for _, data in ipairs(y) do

	local s = 'CoavinsFirearms.AddOrReplaceModel('

	-- Param 1 - model name
	s = s .. "'" .. data.model .. "'"

	-- Param 2 - breaks into
	s = s .. ", { '" .. data.receiver .. "'"
	for _,part in ipairs(data.parts) do
		s = s .. ", '" .. part .. "'"
	end
	s = s .. " }"

	-- Param 3 - store type in
	s = s .. ", '" .. data.receiver .. "'"

	-- Param 4 - fallback type
	if data.fallback then
		s = s .. ", '" .. data.fallback .. "'"
	end

	s = s .. ")\n"

	io.write(s)

end

io.close(f)
